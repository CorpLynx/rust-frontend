<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endpoint Dialog Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
        }
        .test-controls {
            margin-bottom: 20px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        .test-controls button {
            margin-right: 10px;
            padding: 10px 20px;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .test-info {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 14px;
        }
        .test-info h3 {
            margin-top: 0;
            color: var(--accent);
        }
        .test-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .test-info li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h2>Endpoint Dialog Test Page</h2>
        <button onclick="openTestDialog()">Open Add Endpoint Dialog</button>
        <button onclick="openEditTestDialog()">Open Edit Endpoint Dialog</button>
        <button onclick="testValidation()">Test Validation Functions</button>
        
        <div class="test-info">
            <h3>Test Instructions:</h3>
            <ul>
                <li><strong>Add Dialog:</strong> Opens empty dialog, HTTP warning should be visible by default</li>
                <li><strong>Edit Dialog:</strong> Opens dialog with sample data, HTTPS checked, no warning</li>
                <li><strong>Test Validation:</strong> Runs validation functions and logs results to console</li>
            </ul>
            <h3>Manual Tests:</h3>
            <ul>
                <li>Toggle HTTPS checkbox - warning should show/hide</li>
                <li>Enter invalid IP (e.g., 999.999.999.999) - should show error</li>
                <li>Enter invalid port (e.g., 99999) - should show error</li>
                <li>Leave fields empty - should show errors</li>
                <li>Enter valid data - errors should clear</li>
            </ul>
        </div>
    </div>

    <!-- Endpoint Dialog -->
    <div id="endpoint-dialog" class="endpoint-dialog" role="dialog" aria-labelledby="endpoint-dialog-title" aria-hidden="true">
        <div class="endpoint-dialog-content">
            <div class="endpoint-dialog-header">
                <h3 id="endpoint-dialog-title">Add Remote Endpoint</h3>
                <button id="endpoint-dialog-close-btn" class="endpoint-dialog-close-btn" aria-label="Close dialog">×</button>
            </div>
            
            <form id="endpoint-form" class="endpoint-form">
                <div class="form-group">
                    <label for="endpoint-name">Name</label>
                    <input type="text" id="endpoint-name" name="name" placeholder="Production Server" required>
                    <span class="form-error" id="name-error"></span>
                </div>
                
                <div class="form-group">
                    <label for="endpoint-host">Host</label>
                    <input type="text" id="endpoint-host" name="host" placeholder="192.168.1.100" required>
                    <span class="form-error" id="host-error"></span>
                </div>
                
                <div class="form-group">
                    <label for="endpoint-port">Port</label>
                    <input type="number" id="endpoint-port" name="port" placeholder="11434" min="1" max="65535" required>
                    <span class="form-error" id="port-error"></span>
                </div>
                
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="endpoint-https" name="use_https">
                        <span>Use HTTPS</span>
                    </label>
                    <div id="http-warning" class="http-warning" style="display: none;">
                        ⚠️ Warning: Using HTTP for remote endpoints transmits data unencrypted. Use HTTPS for secure communication.
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="endpoint-api-key">API Key (optional)</label>
                    <input type="password" id="endpoint-api-key" name="api_key" placeholder="Enter API key">
                    <span class="form-error" id="api-key-error"></span>
                </div>
                
                <div class="endpoint-dialog-actions">
                    <button type="button" id="test-endpoint-btn" class="btn-secondary">Test Connection</button>
                    <button type="button" id="cancel-endpoint-btn" class="btn-secondary">Cancel</button>
                    <button type="submit" id="save-endpoint-btn" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Validation functions (copied from app.js)
        function validateEndpointName() {
            const nameInput = document.getElementById('endpoint-name');
            const nameError = document.getElementById('name-error');
            const name = nameInput.value.trim();
            
            if (!name) {
                nameError.textContent = 'Name is required';
                return false;
            }
            
            if (name.length > 100) {
                nameError.textContent = 'Name must be 100 characters or less';
                return false;
            }
            
            nameError.textContent = '';
            return true;
        }

        function validateEndpointHost() {
            const hostInput = document.getElementById('endpoint-host');
            const hostError = document.getElementById('host-error');
            const host = hostInput.value.trim();
            
            if (!host) {
                hostError.textContent = 'Host is required';
                return false;
            }
            
            const ipv4Pattern = /^(\d{1,3}\.){3}\d{1,3}$/;
            const ipv6Pattern = /^([0-9a-fA-F]{0,4}:){2,7}[0-9a-fA-F]{0,4}$/;
            const hostnamePattern = /^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
            
            const isValidIpv4 = ipv4Pattern.test(host);
            const isValidIpv6 = ipv6Pattern.test(host);
            const isValidHostname = hostnamePattern.test(host);
            
            if (!isValidIpv4 && !isValidIpv6 && !isValidHostname) {
                hostError.textContent = 'Invalid IP address or hostname format';
                return false;
            }
            
            if (isValidIpv4) {
                const octets = host.split('.');
                for (const octet of octets) {
                    const num = parseInt(octet, 10);
                    if (num < 0 || num > 255) {
                        hostError.textContent = 'Invalid IPv4 address (octets must be 0-255)';
                        return false;
                    }
                }
            }
            
            hostError.textContent = '';
            return true;
        }

        function validateEndpointPort() {
            const portInput = document.getElementById('endpoint-port');
            const portError = document.getElementById('port-error');
            const portValue = portInput.value.trim();
            
            if (!portValue) {
                portError.textContent = 'Port is required';
                return false;
            }
            
            const port = parseInt(portValue, 10);
            
            if (isNaN(port)) {
                portError.textContent = 'Port must be a number';
                return false;
            }
            
            if (port < 1 || port > 65535) {
                portError.textContent = 'Port must be between 1 and 65535';
                return false;
            }
            
            portError.textContent = '';
            return true;
        }

        function updateHttpsWarning() {
            const httpsCheckbox = document.getElementById('endpoint-https');
            const httpWarning = document.getElementById('http-warning');
            
            if (!httpsCheckbox || !httpWarning) return;
            
            if (!httpsCheckbox.checked) {
                httpWarning.style.display = 'block';
            } else {
                httpWarning.style.display = 'none';
            }
        }

        function clearFormErrors() {
            document.getElementById('name-error').textContent = '';
            document.getElementById('host-error').textContent = '';
            document.getElementById('port-error').textContent = '';
            document.getElementById('api-key-error').textContent = '';
        }

        // Test functions
        function openTestDialog() {
            const dialog = document.getElementById('endpoint-dialog');
            const form = document.getElementById('endpoint-form');
            document.getElementById('endpoint-dialog-title').textContent = 'Add Remote Endpoint';
            form.reset();
            clearFormErrors();
            updateHttpsWarning();
            dialog.setAttribute('aria-hidden', 'false');
        }

        function openEditTestDialog() {
            const dialog = document.getElementById('endpoint-dialog');
            document.getElementById('endpoint-dialog-title').textContent = 'Edit Remote Endpoint';
            
            document.getElementById('endpoint-name').value = 'Test Server';
            document.getElementById('endpoint-host').value = '192.168.1.100';
            document.getElementById('endpoint-port').value = '11434';
            document.getElementById('endpoint-https').checked = true;
            document.getElementById('endpoint-api-key').value = 'test-key-123';
            
            clearFormErrors();
            updateHttpsWarning();
            dialog.setAttribute('aria-hidden', 'false');
        }

        function closeDialog() {
            const dialog = document.getElementById('endpoint-dialog');
            dialog.setAttribute('aria-hidden', 'true');
        }

        function testValidation() {
            console.log('Testing validation functions...');
            console.log('Name valid:', validateEndpointName());
            console.log('Host valid:', validateEndpointHost());
            console.log('Port valid:', validateEndpointPort());
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const closeBtn = document.getElementById('endpoint-dialog-close-btn');
            const cancelBtn = document.getElementById('cancel-endpoint-btn');
            const saveBtn = document.getElementById('save-endpoint-btn');
            const testBtn = document.getElementById('test-endpoint-btn');
            const httpsCheckbox = document.getElementById('endpoint-https');
            const dialog = document.getElementById('endpoint-dialog');
            const form = document.getElementById('endpoint-form');

            closeBtn.addEventListener('click', closeDialog);
            cancelBtn.addEventListener('click', closeDialog);
            
            dialog.addEventListener('click', (e) => {
                if (e.target === dialog) {
                    closeDialog();
                }
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const isValid = validateEndpointName() && validateEndpointHost() && validateEndpointPort();
                if (isValid) {
                    alert('Form is valid! Would save endpoint now.');
                    console.log('Form data:', {
                        name: document.getElementById('endpoint-name').value,
                        host: document.getElementById('endpoint-host').value,
                        port: document.getElementById('endpoint-port').value,
                        useHttps: document.getElementById('endpoint-https').checked,
                        apiKey: document.getElementById('endpoint-api-key').value
                    });
                    closeDialog();
                } else {
                    alert('Please fix validation errors');
                }
            });

            testBtn.addEventListener('click', () => {
                alert('Test connection would be called here');
            });

            httpsCheckbox.addEventListener('change', updateHttpsWarning);

            // Real-time validation
            document.getElementById('endpoint-name').addEventListener('input', validateEndpointName);
            document.getElementById('endpoint-host').addEventListener('input', validateEndpointHost);
            document.getElementById('endpoint-port').addEventListener('input', validateEndpointPort);
        });
    </script>
</body>
</html>
